# hashCode

## 哈希碰撞

哈希碰撞指的是不同对象算出了相同的 hashCode。

- 扰动函数

通过扰动函数对原始 hashCode 做二次处理，让 hashCode 的高位和低位充分混合，减少因 hashCode 高位不同、低位相同导致的下标碰撞，从源头降低碰撞概率。

- 拉链法

链式存储在该下标对应的哈希桶中

- 链表转红黑树

## 完整流程

1. 计算插入 key 的原始 hashCode，通过扰动函数得到混合后的 hash 值； 
2. 用hash & (数组长度-1)计算数组下标，找到对应的哈希桶； 
3. 若该桶为空，直接将节点放入桶中，结束； 
4. 若该桶不为空（发生碰撞），分三种情况处理： 
   - 桶中节点是红黑树：调用树的插入方法，将节点加入红黑树； 
   - 桶中节点是链表：遍历链表，若找到 key 相同的节点，覆盖值；若未找到，尾插法加入新节点； 
   - 新节点加入后，若链表长度 **≥8且数组长度≥64**，将链表转为红黑树；
5. 插入完成后，判断实际节点数是否 **≥数组长度 × 负载因子**，若是则触发2 倍扩容，并重哈希分散节点。