# volatile 关键字

**可见性 + 禁止指令重排**

## 可见性

volatile 保证每个线程看到的都是这个变量的最新版本，不会用旧缓存。

## 禁止指令重排

CPU 和 JVM 为了优化，会自动调整指令顺序，只要逻辑上不出错就行。

但在多线程场景下，这可能导致严重问题。

volatile 禁止相关指令重排，确保执行顺序和代码写的顺序一致。

**对 volatile 变量的读写不会被 CPU 或 JVM 调整顺序。**

- volatile 不能保证原子性

原子操作要用 **synchronized** 或 **Atomic 类**

## 常见使用场景

- 单一标志位：开关、状态
- 单例模式的双重检查锁
- 配置热更新

volatile 就像“公告板”：
写的人一写完，所有人立即看到最新消息；
同时，它不允许别人偷偷调换写公告的顺序。

但是，它不负责“排队写公告”，只是让大家看到最新的内容而已。