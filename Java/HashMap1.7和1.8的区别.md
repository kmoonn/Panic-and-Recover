# HashMap 1.7 和 1.8 的区别

| 特性        | 1.7     | 1.8          |
|-----------|---------|--------------|
| 桶内结构      | 单链表     | 链表 + 红黑树     |
| 链表插入方式    | 头插法     | 尾插法          |
| 查找最坏时间复杂度 | O(n)    | O(log n)     |
| 扩容安全性     | 多线程易死循环 | 尾插 + 红黑树机制更稳 |
| 数组初始化     | 创建时立即分配 | 延迟初始化        |

## JDK 1.7

- HashMap 由**数组+单向链表**组成，数组是主体，链表为了解决哈希冲突（**拉链法**）。

- 链表节点类型：`Entry<K,V>`

- 桶数组初始化时立即创建指定容量数组。

- 链表采用**头插法**。多线程情况下容易导致死循环。

## JDK 1.8

- HashMap 解决哈希冲突的方法引入了**红黑树**数据结构。

- 链表节点类型：`Node<K,V>` + 红黑树`TreeNode<K,V>`

- 当链表长度大于等于阈值（默认为 8），判断数组长度，如果小于 64 会先进行数组扩容，否则将链表转化为红黑树，以减少搜索时间。

- 桶数组初始化时懒加载，第一次 put 时创建数组。

- 链表采用**尾插法**。